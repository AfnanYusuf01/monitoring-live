<% layout("layouts/main") %>

<div class="min-h-screen bg-gray-50 py-8">

  <% if (typeof successMessage !== 'undefined' && successMessage) { %>
    <div id="success-notification" class="fixed top-4 right-4 flex items-center px-4 py-3 rounded-lg shadow-lg bg-green-500 text-white z-50 transform transition-transform duration-300">
      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
      </svg>
      <span><%= successMessage %></span>
    </div>

    <script>
      setTimeout(() => {
        const notification = document.getElementById('success-notification');
        if (notification) notification.remove();
      }, 5000);
    </script>
  <% } %>

  <div class="container mx-auto px-4 max-w-4xl">
    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
      <!-- Header -->
      <div class="px-6 py-4 border-b border-gray-100">
        <div class="flex flex-wrap justify-between items-center">
          <div>
            <h1 class="text-2xl font-bold text-gray-800">Edit Data Affiliate</h1>
            <p class="text-sm text-gray-600 mt-1">Perbarui informasi pembayaran komisi Anda</p>
          </div>
          <div>
            <a href="/affiliate" class="inline-flex items-center px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm font-medium rounded-lg transition-colors">
              <i class="fas fa-arrow-left mr-2"></i>
              Kembali ke Dashboard
            </a>
          </div>
        </div>
      </div>

      <!-- Form Section -->
      <div class="px-6 py-6">
        <form id="editAffiliateForm" class="space-y-6">
          <!-- Informasi Pembayaran -->
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Informasi Pembayaran Komisi</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Metode Pembayaran</label>
                <select name="metodeBayar" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                  <option value="">Pilih Metode</option>
                  <option value="bank_transfer" <%= affiliate.metodeBayar === 'bank_transfer' ? 'selected' : '' %>>Transfer Bank</option>
                  <option value="gopay" <%= affiliate.metodeBayar === 'gopay' ? 'selected' : '' %>>GoPay</option>
                  <option value="ovo" <%= affiliate.metodeBayar === 'ovo' ? 'selected' : '' %>>OVO</option>
                  <option value="dana" <%= affiliate.metodeBayar === 'dana' ? 'selected' : '' %>>DANA</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Provider</label>
                <select name="provider" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                  <option value="">Pilih Provider</option>
                  <option value="BCA" <%= affiliate.provider === 'BCA' ? 'selected' : '' %>>BCA</option>
                  <option value="BRI" <%= affiliate.provider === 'BRI' ? 'selected' : '' %>>BRI</option>
                  <option value="BNI" <%= affiliate.provider === 'BNI' ? 'selected' : '' %>>BNI</option>
                  <option value="Mandiri" <%= affiliate.provider === 'Mandiri' ? 'selected' : '' %>>Mandiri</option>
                  <option value="GoPay" <%= affiliate.provider === 'GoPay' ? 'selected' : '' %>>GoPay</option>
                  <option value="OVO" <%= affiliate.provider === 'OVO' ? 'selected' : '' %>>OVO</option>
                  <option value="DANA" <%= affiliate.provider === 'DANA' ? 'selected' : '' %>>DANA</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Nomor Rekening/E-Wallet</label>
                <input 
                  type="text" 
                  name="nomorTujuan" 
                  value="<%= affiliate.nomorTujuan || '' %>"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="Contoh: 1234567890"
                  required
                >
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Atas Nama</label>
                <input 
                  type="text" 
                  name="namaPemilik" 
                  value="<%= affiliate.namaPemilik || '' %>"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="Nama pemilik rekening/akun"
                  required
                >
              </div>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="flex justify-end space-x-3">
            <a href="/affiliate" class="px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded-lg transition-colors">
              Batal
            </a>
            <button 
              type="submit" 
              class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors flex items-center"
            >
              <i class="fas fa-save mr-2"></i>
              Simpan Perubahan
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('editAffiliateForm');
  
  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    try {
      const response = await fetch('/api/affiliates/<%= affiliate.id %>', {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
      });
      
      const result = await response.json();
      
      if (response.ok) {
        window.location.href = '/affiliate?success=' + encodeURIComponent('Data affiliate berhasil diperbarui!');
      } else {
        alert('Error: ' + result.message);
      }
    } catch (error) {
      console.error('Error:', error);
      alert('Terjadi kesalahan saat memperbarui data');
    }
  });
});
</script>